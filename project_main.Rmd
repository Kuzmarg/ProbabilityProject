---
title: "ResearchProject"
output: html_notebook
---

Team members: Vladyslav Humennyy, Volodymyr Kuzma, Svitlana Hovorova.

# The Films Research

We chose a dataset from TMDb, containing various information on films from 1880 to 2022 to explore more about the changes that happened to film industry through the years and test these **4 main hypotheses:**

**1)** The average film duration: we suggest that as time goes films become shorter. H0: on average, the duration of films decreases by 0%; H1: the difference is present. We are also interested in testing this metric in different film categories;

**2)** The frequencies of words used in film titles: we want to find leading words in titles of each year in different genres and see how frequently they occur on the whole timeline;

**3)** The age of leading actors: we assume that in the more recent works, actors are younger. H0: on average, the age of leading actors decreases by 0 years every ten years; H1: the metric is greater;

**4)** The quantities of films of different categories produced: we want to analyze the popularity of genres in particular years.

```{r}
# Needed library
library(BSDA)

# Reading the data from data set
df = read.csv("TMDb_Dataset.csv")
```

## Hypothesis 1: Film Duration

In this part we will take into consideration only films released after 1950, as before that the industry was not really developed and the number of films is not significant.

Here, we test whether the film duration over time actual decreased. The first try was to build a linear regression model of mean film duration over time. **The reason for it is that the linear model can clearly show whether the relation is increasing or decreasing.** We took 5 years periods and built a relation of mean film duration in these periods to the year of film release (for a period of 5 years we took the middle of this period).

```{r}
Years = seq(1950,2015,length = 14)

Runtimes = c()
for (year in Years) {
  runtime = mean(df[strtoi(substring(df$Date, 0, 4)) >= year & 
                   strtoi(substring(df$Date, 0, 4)) < year+5, ]$Runtime)
  Runtimes = append(Runtimes, runtime)
}

Years = Years + 2.5
regressional_model = lm(Runtimes~Years)
plot(Years, Runtimes, col = "blue", main = "Mean film duration over years")
abline(regressional_model, col = "red")
summary(regressional_model)
```

The p-value in the test of slope coefficient is hardly bigger than 0.05. The model here states that our starting assumption is wrong: movies are getting longer. **Nevertheless, the main problem is that real relation is far from linear, so we can not make any conclusions here**.

##### Here you can also see such linear models for different categories of films

```{r}
Categories = c("Crime", "Comedy", "Action", "Thriller", "Adventure", "Science Fiction", "Drama", "Romance")
  
for (category in Categories) {
  Years = seq(1950,2015,length = 14)
  temp_df = df[grepl(category, df$Categories), ]
  
  Runtimes = c()
  for (year in Years) {
    runtime = mean(temp_df[strtoi(substring(temp_df$Date, 0, 4)) >= year & 
                   strtoi(substring(temp_df$Date, 0, 4)) < year+5, ]$Runtime)
    Runtimes = append(Runtimes, runtime)
}
  
  Years = Years + 2.5
  regressional_model = lm(Runtimes~Years)
  plot(Years, Runtimes, col = "blue", main = category)
  abline(regressional_model, col = "red")
  
  
  cat("Summary for", category)
  print(summary(regressional_model))
}
```

The directions of lines for different categories vary significantly, though for some of them the p-value of the testing of slope coefficient is to low to build conclusions based on this estimate.

Though in most cases the p-values for the slope coef. are high, the shown linear graphs **do not realistically represent the relation**, so we decided to **do another test** of the hypothesis and use another simpler yet more accurate method: **divide the films into two categories: those released before 2001 (in the 20th century) and those released after (in the 21st century)**, and then use **t-test** (as we do not have information on the variance) to test $H_0:\mu_{before}=\mu_{after}$ against $H_1:\mu_{before} <\mu_{after}$.

```{r}
duration_21 = df[strtoi(substring(df$Date, 0, 4)) >= 2001,]$Runtime
duration_20 = df[strtoi(substring(df$Date, 0, 4)) < 2001 & strtoi(substring(df$Date, 0, 4)) >= 1950,]$Runtime

t.test(duration_20, duration_21, alternative = "g")
t.test(duration_20, duration_21, alternative = "l")
```

The results are completely opposite to what we expected: the mean duration of movie is significantly bigger in the new century.

##### Here you can also see test results for different categories of films

```{r}
for (category in Categories) {
  temp_df = df[grepl(category, df$Categories), ]
  
  duration_21 = df[strtoi(substring(temp_df$Date, 0, 4)) >= 2001,]$Runtime
  duration_20 = df[strtoi(substring(temp_df$Date, 0, 4)) < 2001 & strtoi(substring(temp_df$Date, 0, 4)) >= 1950,]$Runtime

  cat('Tests for', category)
  print(t.test(duration_20, duration_21, alternative = "g"))
  print(t.test(duration_20, duration_21, alternative = "l"))
}
```

As we see, the only category in which the duration decreased as we expected is **Adventure films** as the p-value of the test, where the $H_1$ is that the duration decreased, is very low, meaning that we should reject $H_0$.

**Overall**, in this part we took a chance to use linear regression and t-test to find out that the duration of films actually did not decrease from the previous century's last decades.\
**Now, let's move to the second hypothesis**

## Part 2: here we want to analyze different film categories and see how their popularities are distributed
Firstly, that`s the quantities of all films from dataframe corresponding to the genre:
```{r}
Categories = c("Crime", "Comedy", "Action", "Thriller", "Adventure", "Science Fiction", "Drama", "Romance")
categories_vec <- c()
for (category in Categories){
  for (row in df$Categories){
    if (grepl(category, row)){
      categories_vec = append(categories_vec, category)
    }
  }
}
categories_counts <- as.data.frame(table(categories_vec))
categories_counts
barplot(categories_counts$Freq, main = "Number of films", names = categories_counts$categories_vec)
```

## Hypothesis 3: Age of Leading Actors

Here, we test whether the film duration over time actual decreased. The first try was to build a linear regression model of mean film duration over time. **The reason for it is that the linear model can clearly show whether the relation is increasing or decreasing.** We took 5 years periods and built a relation of mean film duration in these periods to the year of film release (for a period of 5 years we took the middle of this period).


```{r}
dob_df = read.csv("Birth_Actors.csv")
print(head(dob_df,10))
```

```{r}
age_of_actors_function <- function(start_of_period, end_of_period, step){
  number_of_period = ((end_of_period - start_of_period) / step) + 1

  Years = seq(start_of_period,end_of_period,length = number_of_period)
  
  print(Years)
  
  Ages = c()
  MaleAges = c()
  FemaleAges = c()
  for (year in Years) {
    year_ages = c()
    cast_of_films = df[strtoi(substring(df$Date, 0, 4)) >= year & 
                     strtoi(substring(df$Date, 0, 4)) < year+step, ]$Cast
    
    number_of_actors = 0
    age_of_actors = 0
    number_of_male_actors = 0
    age_of_male_actors = 0
    number_of_female_actors = 0
    age_of_female_actors = 0
    
    for (cast in cast_of_films){
      start_index = unlist(gregexpr("id': ", cast))[1]
      id_with_junk = substr(cast, start_index + 5, start_index + 12)
      id = strtoi(substr(id_with_junk, 1, unlist(gregexpr(",", id_with_junk))[1] - 1))
      gender_start_index = unlist(gregexpr("gender': ", cast))[1]
      gender = strtoi(substr(cast, gender_start_index + 9, gender_start_index + 9))
      row = which(grepl(id, dob_df$Id))[1]
      if (!is.na(row)){
        if (gender == 2){
            number_of_male_actors = number_of_male_actors + 1
            age_of_male_actors = age_of_male_actors + (year - strtoi(dob_df$Birth[row]))
        }
        else{
            number_of_female_actors = number_of_female_actors + 1
            age_of_female_actors = age_of_female_actors + (year - strtoi(dob_df$Birth[row]))
        }
        number_of_actors = number_of_actors + 1
        age_of_actors = age_of_actors + (year - strtoi(dob_df$Birth[row]))
      }
    }
    
    Ages = append(Ages, age_of_actors / number_of_actors)
    MaleAges = append(MaleAges, age_of_male_actors / number_of_male_actors)
    FemaleAges = append(FemaleAges, age_of_female_actors / number_of_female_actors)
    cat("=============================================================================================\n")
    cat("For year ", year, " the average actor age is ", age_of_actors / number_of_actors, "\n")
    cat("For year ", year, " the average male actor age is ", age_of_male_actors / number_of_male_actors, "\n")
    cat("For year ", year, " the average female actor age is ", age_of_female_actors / number_of_female_actors, "\n")
  }
  
  
  plot(Years, MaleAges, col = "blue", main = "Mean Age of Leading Male and Female Actor over Years", ylim = c(25,45))
  points(Years, FemaleAges, col = "purple")
  
  regressional_model_male = lm(MaleAges~Years)
  regressional_model_female = lm(FemaleAges~Years)
  abline(regressional_model_male, col = "blue")
  abline(regressional_model_female, col = "purple")
  summary(regressional_model_male)
  summary(regressional_model_female)
  
  plot(Years, Ages, col="blue", main = "Mean Age of Leading Actor over Years")
  
  regressional_model = lm(Ages~Years)
  abline(regressional_model, col = "red")
  summary(regressional_model)
}
```

```{r}
age_of_actors_function(1955, 2015, 5)
```

```{r}
age_of_actors_function(1955, 1999, 1)
```

```{r}
age_of_actors_function(2000, 2015, 1)
```
